# Distributed under the OpenDDS License. See accompanying LICENSE
# file or http://www.opendds.org/license.html for details.

project(Messenger_cmake CXX)
cmake_minimum_required(VERSION 3.3)

list(APPEND CMAKE_MODULE_PATH "$ENV{DDS_ROOT}/share/cmake/Modules")
find_package(OpenDDS)

# Publisher
add_executable(publisher)
OPENDDS_TARGET_SOURCES(publisher
  PUBLIC
    Writer.cpp Writer.h publisher.cpp
    Messenger.idl)

target_link_libraries(publisher OpenDDS::OpenDDS)

# Subscriber
add_executable(subscriber)
OPENDDS_TARGET_SOURCES(subscriber
  PUBLIC
    DataReaderListener.cpp DataReaderListener.h subscriber.cpp
    Messenger.idl)

target_link_libraries(subscriber OpenDDS::OpenDDS)

# Stacksubscriber
add_executable(stack_subscriber)
OPENDDS_TARGET_SOURCES(stack_subscriber
  PUBLIC
    DataReaderListener.cpp DataReaderListener.h stack_subscriber.cpp
    Messenger.idl)

target_link_libraries(stack_subscriber OpenDDS::OpenDDS)

# Copy configs/scripts into build-output directory
set(_src_dir ${CMAKE_CURRENT_SOURCE_DIR})
set(_dst_dir ${CMAKE_CURRENT_BINARY_DIR})

file(GLOB _ini_src "${_src_dir}/*.ini")
file(GLOB _pl_src "${_src_dir}/*.pl")
add_custom_target(Copy_ini_and_scripts
  ALL
  COMMAND_EXPAND_LISTS
  VERBATIM
  COMMENT "Copying configs/scripts into build-output directory"
  COMMAND ${CMAKE_COMMAND} -E
    copy ${_ini_src} ${_pl_src} ${_dst_dir}/$<CONFIG>)

set(_post_build_deps
  publisher
  subscriber
  stack_subscriber)

add_dependencies(Copy_ini_and_scripts ${_post_build_deps})
